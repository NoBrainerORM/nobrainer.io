<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Validations Â· NoBrainer</title>
  <link rel="stylesheet" href="/css/screen.css" />
</head>

<body class="wrap">
  <header>
  <div class="grid">
    <div class="unit one-fifth"> </div>
    <div class="unit four-fifths">
      <h1> <a href="/"> <span>NoBrainer</span> </a> </h1>
      <h3>A Ruby ORM for RethinkDB</h3>
    </div>
  </div>

<!-- put back when we do it properly for mobiles -->
<!-- <a href="https://github.com/nviennot/nobrainer"><img style="position: absolute; top: 0; right:0; border: 0; width: 149px; height: 149px;" src="/img/forkme.png" alt="Fork me on GitHub"></a> -->

</header>


  <section class="docs">
  <div class="grid">

    <div class="unit one-fifth">
  <aside>
    <h4>Getting Started</h4> 

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/introduction/">Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/differences_from_other_orms/">Differences from other ORMs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Models</h4>          

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/models/">Models</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/fields/">Fields</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/types/">Types</a></li>
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/timestamps/">Timestamps</a></li>
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/serialization/">Serialization</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/persistence/">Persistence</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/callbacks/">Callbacks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/validations/">Validations</a></li>
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/dirty_tracking/">Dirty Tracking</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
      <li class=""><a href="/docs/associations/">Associations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/store_accessor/">Store accessor</a></li>
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Querying</h4>        

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/querying/">Querying</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scopes/">Scopes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/joins/">Joins</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/eager_loading/">Eager Loading</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Advanced Topics</h4> 

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/rql_layer/">RQL Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/indexes/">Indexes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
      <li class=""><a href="/docs/atomic_ops/">Atomic Operations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/distributed_locks/">Distributed Locks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/db_management/">DB Management</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_configuration/">Table Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/multi_tenancy/">Multi Tenancy</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/caching/">Caching</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/event_machine/">Event Machine</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Recipes</h4>         

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/real_time_tutorial/">Real Time Tutorial</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Miscellaneous</h4>   

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/roadmap/">Roadmap</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/changelog/">Changelog</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
      <li class=""><a href="/docs/3rd_party_integration/">3rd-party Integration</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/testing/">Testing</a></li>
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/communication/">Communication</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/faq/">FAQ</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/credits/">Credits</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

  </aside>
</div>


    <div class="like-buttons">
      <div class="github">
        <iframe src="/github-btn.html?user=nviennot&repo=nobrainer&type=watch&count=true"
          allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
      </div>
    </div>

    <div class="unit four-fifths">
      <article>
        <h1>Validations</h1>
        <h2 id="declaring-validators">Declaring Validators</h2>

<p>Validations works the same way as in ActiveRecord because NoBrainer reuses the
ActiveModel validation logic. If you are not familiar with how validations
typically operate, please read the following documentation:
<a href="http://edgeguides.rubyonrails.org/active_record_validations.html">ActiveRecord validations</a>.<br />
However, there are a some differences with the
associated validator and the uniqueness validator, which are explained below.</p>

<p>There are six ways to declare validations with NoBrainer:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">validate_presence_of :field_name</code></li>
  <li><code class="language-plaintext highlighter-rouge">validates :field_name1, :field_name2, :presence =&gt; true</code></li>
  <li><code class="language-plaintext highlighter-rouge">validate { errors.add(:base, "too many friends") if too_many_friends? }</code></li>
  <li><code class="language-plaintext highlighter-rouge">field :field_name, :validates =&gt; { :presence =&gt; true }</code></li>
  <li>Using shorthands as described below.</li>
  <li>Using types: <code class="language-plaintext highlighter-rouge">field :field_name, :type =&gt; Integer</code>. This will validate that the
given field is an integer. Read more about the type checking mechanism in the
<a href="/docs/types">Types</a> section.</li>
</ul>

<h2 id="shorthands">Shorthands</h2>

<h3 id="required">required</h3>

<p>You may use the <code class="language-plaintext highlighter-rouge">required</code> shorthand to specify a presence validator, except
with <code class="language-plaintext highlighter-rouge">Boolean</code> types for which a <code class="language-plaintext highlighter-rouge">not_null</code> validator is used instead.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">field</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
<span class="c1"># Equivalent to:</span>
<span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span>
  <span class="n">field</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:not_null</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<h3 id="uniqunique">uniq/unique</h3>

<p>You may use the <code class="language-plaintext highlighter-rouge">uniq</code> (or <code class="language-plaintext highlighter-rouge">unique</code>) shorthand to specify a uniqueness validator:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:uniq</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">:uniq</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:scope</span> <span class="o">=&gt;</span> <span class="ss">:team</span><span class="p">}</span>
<span class="k">end</span>
<span class="c1"># Equivalent to:</span>
<span class="k">class</span> <span class="nc">Model</span>
  <span class="n">validates_uniqueness_of</span> <span class="ss">:email</span>
  <span class="n">validates_uniqueness_of</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:scope</span> <span class="o">=&gt;</span> <span class="ss">:team</span>
<span class="k">end</span></code></pre></figure>

<p>NoBrainer provides race-free semantics with uniqueness validators. You may
read more about it <a href="#the_uniqueness_validator">below</a>.</p>

<h3 id="in">in</h3>

<p>You may use the <code class="language-plaintext highlighter-rouge">in</code> shorthand to specify an inclusion validator:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:state</span><span class="p">,</span> <span class="ss">:in</span> <span class="o">=&gt;</span> <span class="sx">%w(start finish)</span>
<span class="k">end</span>
<span class="c1"># Equivalent to:</span>
<span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:state</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:inclusion</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:in</span> <span class="o">=&gt;</span> <span class="sx">%w(start finish)</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<h3 id="format">format</h3>

<p>You may use the <code class="language-plaintext highlighter-rouge">format</code> shorthand to specify a format validator:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="sr">/\A[a-z]+\z/</span>
<span class="k">end</span>
<span class="c1"># Equivalent to:</span>
<span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="sr">/\A[a-z]+\z/</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<h3 id="lengthmin_lengthmax_length">length/min_length/max_length</h3>

<p>You may use the <code class="language-plaintext highlighter-rouge">length</code>, <code class="language-plaintext highlighter-rouge">min_length</code>, <code class="language-plaintext highlighter-rouge">max_length</code> shorthand to specify a length validator:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:field1</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">field</span> <span class="ss">:field2</span><span class="p">,</span> <span class="ss">:min_length</span> <span class="o">=&gt;</span> <span class="mi">4</span>
  <span class="n">field</span> <span class="ss">:field3</span><span class="p">,</span> <span class="ss">:max_length</span> <span class="o">=&gt;</span> <span class="mi">10</span>
<span class="k">end</span>
<span class="c1"># Equivalent to:</span>
<span class="k">class</span> <span class="nc">Model</span>
  <span class="n">field</span> <span class="ss">:field1</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">field</span> <span class="ss">:field2</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:minimum</span> <span class="o">=&gt;</span> <span class="mi">4</span> <span class="p">}</span> <span class="p">}</span>
  <span class="n">field</span> <span class="ss">:field3</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<h2 id="when-are-validations-performed">When are validations performed?</h2>

<h3 id="validations-are-performed-on">Validations are performed on:</h3>

<p>Validations are performed when calling the following methods on an instance:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">create</code></li>
  <li><code class="language-plaintext highlighter-rouge">create!</code></li>
  <li><code class="language-plaintext highlighter-rouge">save</code></li>
  <li><code class="language-plaintext highlighter-rouge">save!</code></li>
  <li><code class="language-plaintext highlighter-rouge">update</code></li>
  <li><code class="language-plaintext highlighter-rouge">update!</code></li>
</ul>

<p>If you want to bypass validations, you may pass the <code class="language-plaintext highlighter-rouge">:validate =&gt; false</code> option
to these methods, which can be quite handy in a development console. Do not use
such thing in your actual code.</p>

<p>The <code class="language-plaintext highlighter-rouge">!</code> version of these methods raise a <code class="language-plaintext highlighter-rouge">NoBrainer::Error::DocumentInvalid</code>
exception when validation fails. If left uncaught in a Rails controller, a 422
status code will be returned.
The vanilla versions populate the errors array attached to the instance.
<code class="language-plaintext highlighter-rouge">save()</code> and <code class="language-plaintext highlighter-rouge">update()</code> return true or false depending if the validations
failed. When using <code class="language-plaintext highlighter-rouge">create()</code>, you may call <code class="language-plaintext highlighter-rouge">persisted?</code> to check if the
model was valid and persisted.</p>

<h3 id="validations-are-not-performed-on">Validations are <em>not</em> performed on:</h3>

<ul>
  <li>Validations are not performed when updating all documents matching a criteria,
such as <code class="language-plaintext highlighter-rouge">Model.update_all()</code>.</li>
  <li>Attribute validations are not run when their corresponding attribute have
not changed (through <a href="/docs/dirty_tracking">dirty tracking</a>).</li>
</ul>

<h2 id="presence-validations-on-belongs_to-associations">Presence Validations on belongs_to Associations</h2>

<p>Foreign keys in belongs_to associations are always validated when the foreign
key is present. If you wish to disable this behavior, you may pass <code class="language-plaintext highlighter-rouge">validates =&gt;
false</code> on the association declaration.</p>

<p>Additionally, you may add a presence validator as such:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Comment</span>
  <span class="n">belongs_to</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span></code></pre></figure>

<h2 id="the-uniqueness-validator">The Uniqueness Validator</h2>

<p>The uniqueness validator ensures that a field value can be present at most
once table wide.</p>

<p>When working with traditional ORMs, the uniqueness validator is known to be
racy: two concurrent requests may both pass the validation, and both could
persist successfully the same supposedly unique field.
Uniqueness validators are useful in conjunction with unique secondary indexes.
Since RethinkDB is a sharded database, implementing unique
secondary indexes is a performance problem, and so the RethinkDB team rightfully
decided not to implement them. To properly ensure uniqueness with RethinkDB,
one must either leverage the primary key uniqueness guarantee, or use a
distributed lock.  For this reason, NoBrainer uses its implementation of
<a href="/docs/distributed_locks">distributed locks</a> to ensure race-free semantics.</p>

<p>The locks are acquired after the <code class="language-plaintext highlighter-rouge">before_create/update</code> callbacks, and before
the <code class="language-plaintext highlighter-rouge">after_create/update</code> callbacks. NoBrainer alpha sorts the keys to be
acquired to avoid deadlock issues when performing multiple uniqueness
validations on the same document. For performance reasons, NoBrainer only
performs uniqueness validations when the involved fields change.</p>

<h3 id="using-scopes">Using scopes</h3>

<p>The uniqueness validator accept a <code class="language-plaintext highlighter-rouge">:scope</code> option which can be a field, or an
array of fields. For example:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">TeamMember</span>
  <span class="n">field</span> <span class="ss">:team_name</span>
  <span class="c1"># Do not allow duplicate emails within a team.</span>
  <span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:uniqueness</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:scope</span> <span class="o">=&gt;</span> <span class="ss">:team_name</span><span class="p">}}</span>
<span class="k">end</span></code></pre></figure>

<p>It is highly recommended that you add a presence validator on the scoped fields,
because RethinkDB considers <code class="language-plaintext highlighter-rouge">nil</code> and <code class="language-plaintext highlighter-rouge">undefined</code> to be two different things.</p>

<h2 id="differences-with-activemodel">Differences with ActiveModel</h2>

<h3 id="associated-validator">Associated Validator</h3>

<p>The associated validator is not implemented.</p>

<h3 id="uniqueness-validator">Uniqueness Validator</h3>

<p>The uniqueness validator does not accept the <code class="language-plaintext highlighter-rouge">:case_sensitive</code> option.
Downcasing the attribute in a <code class="language-plaintext highlighter-rouge">before_save/validation</code> callback is a better idea.</p>

<h3 id="notnull-validator">NotNull Validator</h3>

<p>NoBrainer supports an additional validator <code class="language-plaintext highlighter-rouge">not_null</code>. It rejects undefined and
nil values.</p>

      </article>
    </div>

    <div class="clear"></div>

  </div>
</section>


  <footer>
  <div class="grid">
    <div class="unit whole">
      NoBrainer was created by <a href="https://github.com/nviennot">Nicolas Viennot</a>
      and is maintained by <a href="https://github.com/zedtux">Guillaume Hain</a>.
    </div>
  </div>
</footer>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46753546-1', 'nobrainer.io');
  ga('send', 'pageview');
</script>

</body>
</html>
