<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Fields Â· NoBrainer</title>
  <link rel="stylesheet" href="/css/screen.css" />
</head>

<body class="wrap">
  <header>
  <div class="grid">
    <div class="unit one-fifth"> </div>
    <div class="unit four-fifths">
      <h1> <a href="/"> <span>NoBrainer</span> </a> </h1>
      <h3>A Ruby ORM for RethinkDB</h3>
    </div>
  </div>

<!-- put back when we do it properly for mobiles -->
<!-- <a href="https://github.com/nviennot/nobrainer"><img style="position: absolute; top: 0; right:0; border: 0; width: 149px; height: 149px;" src="/img/forkme.png" alt="Fork me on GitHub"></a> -->

</header>


  <section class="docs">
  <div class="grid">

    <div class="unit one-fifth">
  <aside>
    <h4>Getting Started</h4> 

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/introduction/">Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/differences_from_other_orms/">Differences from other ORMs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Models</h4>          

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/models/">Models</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/fields/">Fields</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/types/">Types</a></li>
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/timestamps/">Timestamps</a></li>
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/serialization/">Serialization</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/persistence/">Persistence</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/callbacks/">Callbacks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/validations/">Validations</a></li>
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/dirty_tracking/">Dirty Tracking</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
      <li class=""><a href="/docs/associations/">Associations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/store_accessor/">Store accessor</a></li>
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Querying</h4>        

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/querying/">Querying</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scopes/">Scopes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/joins/">Joins</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/eager_loading/">Eager Loading</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Advanced Topics</h4> 

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/rql_layer/">RQL Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/indexes/">Indexes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
      <li class=""><a href="/docs/atomic_ops/">Atomic Operations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/distributed_locks/">Distributed Locks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/db_management/">DB Management</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_configuration/">Table Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/multi_tenancy/">Multi Tenancy</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/caching/">Caching</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/event_machine/">Event Machine</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Recipes</h4>         

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/real_time_tutorial/">Real Time Tutorial</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Miscellaneous</h4>   

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/roadmap/">Roadmap</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/changelog/">Changelog</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
      <li class=""><a href="/docs/3rd_party_integration/">3rd-party Integration</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/testing/">Testing</a></li>
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/communication/">Communication</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/faq/">FAQ</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/credits/">Credits</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

  </aside>
</div>


    <div class="like-buttons">
      <div class="github">
        <iframe src="/github-btn.html?user=nviennot&repo=nobrainer&type=watch&count=true"
          allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
      </div>
    </div>

    <div class="unit four-fifths">
      <article>
        <h1>Fields</h1>
        <h2 id="field-declaration">Field Declaration</h2>

<p>With NoBrainer, persisted model attributes are called fields or attributes
interchangeably in the documentation.
Declaring a field is done by using the <code class="language-plaintext highlighter-rouge">field</code> method.
For example, the following defines a <code class="language-plaintext highlighter-rouge">User</code> model with a first and last name:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">NoBrainer</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:first_name</span>
  <span class="n">field</span> <span class="ss">:last_name</span>
<span class="k">end</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">field</code> accepts the following options:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">:index</code> to specify an index.</li>
  <li><code class="language-plaintext highlighter-rouge">:default</code> to specify a default value.</li>
  <li><code class="language-plaintext highlighter-rouge">:type</code> to enforce a type.</li>
  <li><code class="language-plaintext highlighter-rouge">:readonly</code> to specify if a field cannot be updated.</li>
  <li><code class="language-plaintext highlighter-rouge">:primary_key</code> to specify a custom primary key.</li>
  <li><code class="language-plaintext highlighter-rouge">:store_as</code> to specify an alias in the database.</li>
  <li><code class="language-plaintext highlighter-rouge">:lazy_fetch</code> to specify whether this field should be fetched on demand.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">field</code> also accepts the following validation options:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">:validates</code> to specify validations.</li>
  <li><code class="language-plaintext highlighter-rouge">:required</code> as a shorthand for the presence validation (except with Boolean
types, for which the not_null validation is used).</li>
  <li><code class="language-plaintext highlighter-rouge">:uniq</code> (or <code class="language-plaintext highlighter-rouge">:unique</code>) as a shorthand for the uniqueness validation.</li>
  <li><code class="language-plaintext highlighter-rouge">:format</code> as a shorthand for the format validation.</li>
  <li><code class="language-plaintext highlighter-rouge">:in</code> as a shorthand for the inclusion validation.</li>
  <li><code class="language-plaintext highlighter-rouge">:length</code> as a shorthand for the length validation.</li>
  <li><code class="language-plaintext highlighter-rouge">:min_length</code> as a shorthand for the minimum length validation.</li>
  <li><code class="language-plaintext highlighter-rouge">:max_length</code> as a shorthand for the maximum length validation.</li>
</ul>

<h2 id="accessing-fields">Accessing Fields</h2>

<p>Defined fields can be accessed with the following methods:</p>

<p>Reading an attribute <code class="language-plaintext highlighter-rouge">attr</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">self.attr</code></li>
  <li><code class="language-plaintext highlighter-rouge">self.read_attribute(attr)</code></li>
  <li><code class="language-plaintext highlighter-rouge">self[attr]</code></li>
</ul>

<p>Writing an attribute <code class="language-plaintext highlighter-rouge">attr</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">self.attr = value</code></li>
  <li><code class="language-plaintext highlighter-rouge">self.write_attribute(attr, value)</code></li>
  <li><code class="language-plaintext highlighter-rouge">self[attr] = value</code></li>
</ul>

<p>Reading all attributes:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">self.attributes</code>: returns attributes. <code class="language-plaintext highlighter-rouge">read_attribute()</code> is used to compute
the values.</li>
  <li><code class="language-plaintext highlighter-rouge">self.inspectable_attributes</code>: returns internal attributes used for debugging
purposes.</li>
</ul>

<p>Mass assignment:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">self.assign_attributes(attrs_hash)</code></li>
</ul>

<p>Methods lower in the list calls the method directly above it.
For example, <code class="language-plaintext highlighter-rouge">self[attr]</code> calls <code class="language-plaintext highlighter-rouge">read_attribute(attr)</code> which calls <code class="language-plaintext highlighter-rouge">self.attr</code>.</p>

<p>Note that there is no <code class="language-plaintext highlighter-rouge">attr_protected</code> method to control mass assignments.
When passing raw <code class="language-plaintext highlighter-rouge">params</code> from Rails controller to NoBrainer, an
<code class="language-plaintext highlighter-rouge">ActiveModel::ForbiddenAttributesError</code> is raised.
<code class="language-plaintext highlighter-rouge">params</code> must be sanitized with
<a href="https://github.com/rails/strong_parameters">strong parameters</a>.</p>

<h2 id="overriding-attributes">Overriding attributes</h2>

<p>If you wish to override an attribute getter or setter, you may define
the <code class="language-plaintext highlighter-rouge">attr</code> and <code class="language-plaintext highlighter-rouge">attr=</code> methods in your class. <code class="language-plaintext highlighter-rouge">super</code> can be used as usual.
The following shows an example that uses <code class="language-plaintext highlighter-rouge">super</code> in the setter:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">NoBrainer</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:email</span>

  <span class="k">def</span> <span class="nf">email</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">strip</span><span class="p">.</span><span class="nf">downcase</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Note that the setters are <em>not</em> used when reading a document from the database.
Keep this in mind when your database does not match your schema.</p>

<h2 id="accessing-raw-attributes">Accessing raw attributes</h2>

<p><code class="language-plaintext highlighter-rouge">self._read_attribute(attr)</code> and <code class="language-plaintext highlighter-rouge">self._write_attribute(attr, value)</code> access
internal attributes, bypassing any type checking. These methods should not be
used for regular use. Do not use these methods when overriding getters/setters
(see above).</p>

<h2 id="default-values">Default Values</h2>

<p>To assign a default value to a field, you may pass a <code class="language-plaintext highlighter-rouge">default</code> option.
You can pass a value or a lambda. The latter will be evaluated at the time of
the assignment in the context of the document, which is useful to set
values depending on other already set attributes.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">field</span> <span class="ss">:num_friends</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="n">field</span> <span class="ss">:created_at</span><span class="p">,</span>  <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="p">}</span></code></pre></figure>

<p>Defaults values are assigned whenever a model is instantiated in memory, which
happens when <code class="language-plaintext highlighter-rouge">Model.new</code> is called. Reading a model from the database
calls <code class="language-plaintext highlighter-rouge">Model.new</code> and therefore performs default value assignments.</p>

<p>A default value is only assigned when the corresponding attribute has not been
set. For example, calling <code class="language-plaintext highlighter-rouge">Model.create(:created_at =&gt; nil)</code> will not trigger
the default value assignment on <code class="language-plaintext highlighter-rouge">created_at</code>. Please create a GitHub issue
if this behavior is a problem for you.</p>

<p>Note that specifying a default value at some point in time does not apply
the default value to existing documents in the database. Existing documents must
be manually migrated.</p>

<h2 id="readonly-fields">Readonly Fields</h2>

<p>When declaring a field with <code class="language-plaintext highlighter-rouge">:readonly =&gt; true</code>, the field cannot be reassigned
once persisted to the database.</p>

<h2 id="primary-key">Primary Key</h2>

<p>NoBrainer allows custom primary keys with the <code class="language-plaintext highlighter-rouge">:primary_key =&gt; true</code> option.
The default primary key is <code class="language-plaintext highlighter-rouge">id</code> and has a format that matches <code class="language-plaintext highlighter-rouge">[A-Za-z0-9]{14}</code>.
It has interesting property compared to UUIDs because these IDs are
monotonically increasing with time. NoBrainer always sort by primary key by
default to give predicable and repeatable results. For example, <code class="language-plaintext highlighter-rouge">Model.last</code>
yields the latest created model, which can be quite handy in development mode.</p>

<p>When comparing two models with <code class="language-plaintext highlighter-rouge">==</code> or <code class="language-plaintext highlighter-rouge">eql?</code>, only the primary keys are
compared, not the other attributes.</p>

<p>Specifying a custom primary key changes the default foreign key names in
belongs_to associations.</p>

<h2 id="dynamic-attributes">Dynamic Attributes</h2>

<p>Dynamic attributes are supported by NoBrainer, but are not enabled by default.
You must include the <code class="language-plaintext highlighter-rouge">NoBrainer::Document::DynamicAttributes</code> mixin in your model.</p>

<p>By doing so, you will be able to read/write arbitrary attributes to your model with
<code class="language-plaintext highlighter-rouge">read_attribute()</code>/ <code class="language-plaintext highlighter-rouge">[]</code> and <code class="language-plaintext highlighter-rouge">write_attribute()</code>/<code class="language-plaintext highlighter-rouge">[]=</code>.</p>

<h2 id="types">Types</h2>

<p>Field types can be declared as such:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">String</span></code></pre></figure>

<p>Read the <a href="/docs/types">Types</a> section to learn more.</p>

<h2 id="validations">Validations</h2>

<p>Validations can be declared directly on the field declaration:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:validates</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="sr">/@/</span> <span class="p">}</span> <span class="p">}</span></code></pre></figure>

<p>Read the <a href="/docs/validations">Validations</a> section to learn more.</p>

<h2 id="indexes">Indexes</h2>

<p>A index can be declared on a field as such:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:index</span> <span class="o">=&gt;</span> <span class="kp">true</span></code></pre></figure>

<p>Read the <a href="/docs/indexes">indexes</a> section to learn more.</p>

<h2 id="aliases">Aliases</h2>

<p>An alias can be specified on a given field as such:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:store_as</span> <span class="o">=&gt;</span> <span class="ss">:e</span></code></pre></figure>

<p>NoBrainer will translate all the references to that field when compiling queries
and reading models back from the database.</p>

<p>A simple index declared on an aliased field carries the name of alias in the database,
unless specified otherwise by an <code class="language-plaintext highlighter-rouge">:store_as</code> option on the index.</p>

<p><strong>Warning</strong>: When passing raw RQL to NoBrainer, aliases do not get translated.</p>

<h2 id="lazy-fetching">Lazy Fetching</h2>

<p>Some fields can have large content size, for example binary fields.
It might be undesirable to fetch them all the time.
NoBrainer can fetch certain fields on demand by declaring a field to be lazy
fetched. For example:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="n">field</span> <span class="ss">:email</span><span class="p">,</span>  <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">String</span>
  <span class="n">field</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">Binary</span><span class="p">,</span> <span class="ss">:lazy_fetch</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">first</span>
<span class="n">user</span><span class="p">.</span><span class="nf">email</span>  <span class="c1"># In memory access.</span>
<span class="n">user</span><span class="p">.</span><span class="nf">avatar</span> <span class="c1"># Performs an extra query to fetch the data.</span></code></pre></figure>

<h2 id="virtual-attributes">Virtual Attributes</h2>

<p>NoBrainer can merge RQL values which appear as regular attributes on the model
instance. Using <code class="language-plaintext highlighter-rouge">virtual_field</code> allows to specify a custom RQL expression that
will be evaluated by the database when performing queries.</p>

<p>The following example adds a <code class="language-plaintext highlighter-rouge">current_user_following</code> virtual attribute to a
<code class="language-plaintext highlighter-rouge">User</code> model that returns whether the current user follows that user or not.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="n">virtual_field</span> <span class="ss">:current_user_following</span> <span class="k">do</span> <span class="o">|</span><span class="n">doc</span><span class="o">|</span>
    <span class="k">if</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">current</span><span class="p">[</span><span class="ss">:current_user</span><span class="p">]</span>
      <span class="no">Followship</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:follower_id</span> <span class="o">=&gt;</span> <span class="n">doc</span><span class="p">[</span><span class="ss">:id</span><span class="p">],</span> <span class="ss">:following_id</span> <span class="o">=&gt;</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">current</span><span class="p">[</span><span class="ss">:current_user</span><span class="p">].</span><span class="nf">id</span><span class="p">).</span><span class="nf">to_rql</span><span class="p">.</span><span class="nf">is_empty</span><span class="p">.</span><span class="nf">not</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<h2 id="reflection">Reflection</h2>

<p>You can access the field definitions with <code class="language-plaintext highlighter-rouge">Model.fields</code>.<br />
It returns a hash of the form <code class="language-plaintext highlighter-rouge">{:field_name =&gt; options}</code>.</p>

<p>You can undefine a previously defined field with
<code class="language-plaintext highlighter-rouge">Model.remove_field(field_name)</code>. This feature is needed when removing the
default primary key <code class="language-plaintext highlighter-rouge">id</code> for example.</p>

<p>You may access the name of the current primary key with <code class="language-plaintext highlighter-rouge">Model.pk_name</code>.
You may access the primary key value of a document with <code class="language-plaintext highlighter-rouge">instance.pk_value</code>.</p>

      </article>
    </div>

    <div class="clear"></div>

  </div>
</section>


  <footer>
  <div class="grid">
    <div class="unit whole">
      NoBrainer was created by <a href="https://github.com/nviennot">Nicolas Viennot</a>
      and is maintained by <a href="https://github.com/zedtux">Guillaume Hain</a>.
    </div>
  </div>
</footer>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46753546-1', 'nobrainer.io');
  ga('send', 'pageview');
</script>

</body>
</html>
